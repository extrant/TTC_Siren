# 基于 最终幻想14规则 的幻卡对战求解器

本项目实现了一个幻卡对战 AI 求解器，采用博弈树搜索算法和并行处理技术。项目的核心是一个游戏状态评估和移动预测引擎，同时提供了可选的 HTTP 服务器接口以便集成使用。

# 目前问题

在针对未知卡牌的算法时，采用的是暴力的未知卡牌填充。这是一个暂时没有被解决的问题，目前我还没有找到解决方法，这是一个非对称的棋牌类对弈游戏，问题主要体现在以下几个方面：

1. **搜索空间爆炸**
   - 每个未知卡牌都需要考虑所有可能的卡牌组合，导致搜索深度低
   - 由于游戏卡池庞大，即使去除已知卡牌，可能性仍然很高
   - 在三明牌和无明牌规则下尤其明显，因为有部分卡牌信息缺失只能暴力填充

2. **评估函数的不确定性**
   - 对手未知卡牌的真实价值无法准确评估
   - 最坏情况假设可能过于保守
   - 概率估计可能不够准确，导致决策偏差

3. **时间复杂度限制**
   - 5秒的决策时间限制下，无法遍历所有可能性（受限于幻卡对局的时间限制）
   - 需要在准确性和速度之间做出权衡
   - 并行计算也无法完全解决这个问题

4. **可能的优化方向**
   - 使用统计学方法预测对手卡牌分布（不确定）
   - 基于历史对局数据建立卡牌使用模型
   - 优化更加合理剪枝策略（感觉不是很有用）
   - 优化评估函数对未知信息的处理

这个问题的本质在于不完全信息博弈（非对称博弈）中的决策优化，类似的挑战在很多卡牌游戏AI中都存在。这个求解器还在进行优化。

## 核心求解器功能

### AI 引擎 (ai.py)
项目的核心是 AI 求解引擎，实现了以下功能：
- 基于 Alpha-Beta 剪枝的高级极小化极大值搜索
- 用于最优时间管理的迭代深化搜索
- 基于多重启发式的复杂状态评估
- 置换表和基于历史的移动排序
- 并行处理以提升性能

### 关键算法特性

- **高级搜索算法**
  - 带时间控制的迭代深化搜索
  - 用于高效树探索的 Alpha-Beta 剪枝
  - 使用历史启发的移动排序优化
  - 动态位置评估

- **性能优化**
  - 用于状态缓存的置换表
  - 用于智能移动排序的历史表
  - 并行处理支持
  - 默认 5 秒的时间控制搜索

## 游戏状态评估

求解器使用复杂的评估函数，考虑以下因素：
1. 卡牌位置权重
   - 角落：1.5 倍权重（战略重要性）
   - 中心：1.2 倍权重（控制位置）
   - 其他位置：1.0 倍权重
2. 卡牌星级及其战术价值
3. 卡牌数值和翻转潜力
4. 棋盘控制和领地分析
5. 翻转可能性和连锁反应

## 游戏规则支持

求解器支持多种游戏规则：
- 全明牌：所有卡牌可见
- 三明牌：三张卡牌可见
- 同数：相同数字规则
- 加算：数字相加规则

## 未知卡牌处理

求解器对未知对手卡牌有特殊处理：
- 未知卡牌表示为 [0,0,0,0]（所有数字设为 0）
- 遇到未知卡牌时，求解器会：
  1. 考虑剩余卡池中所有可能的卡牌
  2. 假设最坏情况评估移动
  3. 对未知对手手牌使用基于概率的评估
  4. 根据可见信息和游戏规则调整策略

## HTTP 服务器接口（可选）

项目提供了一个基于 Flask 的 HTTP 服务器（ai_server.py）用于集成。

### 接口：`/ai_move`

**方法：** POST

**请求体结构：**
```json
{
    "board": [
        {
            "pos": [row, col],  // 位置 [0-2, 0-2]
            "numU": number,     // 上方数字 (1-9)
            "numR": number,     // 右方数字 (1-9)
            "numD": number,     // 下方数字 (1-9)
            "numL": number,     // 左方数字 (1-9)
            "owner": number     // 1 为蓝方，2 为红方
        }
    ],
    "myHand": [
        {
            "numU": number,     // 未知卡牌使用 [0,0,0,0]
            "numR": number,
            "numD": number,
            "numL": number
        }
    ],
    "oppHand": [
        {
            "numU": number,     // 未知卡牌使用 [0,0,0,0]
            "numR": number,
            "numD": number,
            "numL": number
        }
    ],
    "myOwner": number,  // 1 为蓝方，2 为红方
    "rules": string     // 游戏规则（如 "全明牌", "三明牌", "同数", "加算"）
}
```

**响应结构：**
```json
{
    "card": string,     // 选择的卡牌信息（如 "U8 R9 D7 L6 星级:3"）
    "pos": [row, col]   // 选择的位置 [0-2, 0-2]
}
```

## 项目依赖

- Python 3.x
- Pandas（用于卡牌数据库管理）
- Flask（可选，用于 HTTP 服务器）

## 数据库结构

求解器需要一个 CSV 格式的数据库文件（"幻卡数据库.csv"），包含以下列：
- 序号（ID）
- Top（上方数字）
- Right（右方数字）
- Bottom（下方数字）
- Left（左方数字）
- 星级 